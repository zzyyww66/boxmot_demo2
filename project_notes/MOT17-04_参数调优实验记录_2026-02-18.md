# MOT17-04 参数调优实验记录（2026-02-18）

## 1. 实验目标

在 **保持其他指标不变或轻微变好** 的前提下，尽量降低 `IDSW`。  
数据集固定为 `MOT17-04`，并且只做“关联 + 评估”，不重跑检测。

---

## 2. 实验设置

### 2.1 基准配置

基准使用当前 improved 配置（`run_mot17_04_comparison.py` 里的 `IMPROVED_CONFIG`），关键点：

- `entry_margin=50`
- `strict_entry_gate=True`
- `exit_zone_enabled=True`
- `exit_zone_margin=50`
- `exit_zone_remove_grace=30`
- `adaptive_zone_enabled=True`
- `adaptive_zone_update_mode=always_expand`
- `adaptive_zone_expand_trigger=all_high`
- 其他参数保持当前默认/改进值

### 2.2 基准指标（reference）

- `HOTA=78.375`
- `MOTA=90.855`
- `IDF1=89.816`
- `IDSW=20`
- `IDs=76`

### 2.3 约束（guardrail）

筛选候选配置时要求：

- `HOTA >= 78.275`（最多下降 0.10）
- `MOTA >= 90.755`（最多下降 0.10）
- `IDF1 >= 89.716`（最多下降 0.10）

在满足约束后再按以下顺序选最优：

1. `IDSW` 最小
2. `IDs` 最小
3. `IDF1` 最大
4. `MOTA` 最大
5. `HOTA` 最大

---

## 3. 搜索策略与参数空间

执行脚本：`run_mot17_04_param_sweep.py`

### 3.1 Phase A（16 组，单因子）

围绕 improved 基准单参数扰动：

- `entry_margin`: 40, 60
- `exit_zone_margin`: 35, 65
- `exit_zone_remove_grace`: 24, 36, 42
- `zombie_dist_thresh`: 130, 170
- `zombie_max_predict_frames`: 4, 6
- `adaptive_zone_expand_trigger`: outside_high
- `adaptive_zone_margin`: 40, 60
- `adaptive_zone_min_box_area`: 200, 400

### 3.2 Phase B（12 组，组合）

根据 Phase A 敏感性自动选取 Top4 参数做组合搜索。实际选出的关键参数包括：

- `zombie_max_predict_frames`
- `zombie_dist_thresh`
- `exit_zone_remove_grace`

### 3.3 稳定性复跑

对筛选后的 Top3 配置，各追加 2 次复跑（共 6 组）。

---

## 4. 执行命令与产物

### 4.1 运行命令

```bash
uv run python run_mot17_04_param_sweep.py
```

### 4.2 结果文件

- 结构化结果：`runs/ablation/param_sweep/mot17_04_param_sweep_results.json`

---

## 5. 结果总览

### 5.1 数量统计

- Reference: 1 组
- Phase A: 18 组
- Phase B: 12 组
- Top3 复跑: 6 组
- 总运行数: **37 组**

### 5.2 候选结果分布（A+B 共 30 组）

- 通过 guardrail: **28 组**
- 未通过 guardrail: **2 组**
- 指标组合去重后仅有 **2 种**：
  - 组合 1（28 组）：`78.375 / 90.855 / 89.816 / IDSW 20 / IDs 76`
  - 组合 2（2 组）：`78.457 / 90.653 / 90.792 / IDSW 20 / IDs 76`

未通过的 2 组均为：

- `sweep_A06_exit_zone_remove_grace_36`
- `sweep_A07_exit_zone_remove_grace_42`

它们的问题是 `MOTA=90.653`，相对 reference 下降 `-0.202`，超过允许的 `-0.10`。

### 5.3 最优候选

脚本选出的最优候选：

- 名称：`sweep_A01_entry_margin_40`
- 相对 improved 的唯一参数变化：`entry_margin: 50 -> 40`
- 但指标与 improved **完全一致**：
  - `HOTA=78.375`
  - `MOTA=90.855`
  - `IDF1=89.816`
  - `IDSW=20`
  - `IDs=76`

Top3 复跑（每组 2 次）结果也完全一致，标准差全为 0。

---

## 6. 结果解释

### 6.1 本轮没有继续降低 IDSW 的直接结论

在当前数据、当前检测结果、当前改进逻辑下，  
本轮 30 组参数扰动没有改变最终关联决策轨迹，导致 `IDSW` 固定在 20。

### 6.2 `exit_zone_remove_grace` 过大为何被筛掉

当 `exit_zone_remove_grace` 从 30 提高到 36/42 时：

- `IDSW` 没有下降（仍为 20）
- `MOTA` 明显下降（90.855 -> 90.653）

说明更长的 exit 保留窗口在该序列上引入了额外代价（例如错误保留带来的 FP/匹配副作用），  
但并未换来 IDSW 改善，因此不满足本次优化目标。

### 6.3 现阶段状态判断

对“仅改进模块参数”的这一轮搜索可判断为：  
当前 improved 配置已处于该局部搜索空间的稳定平台区。

---

## 7. 结论与下一步

### 7.1 结论

- 本轮没有找到 `IDSW < 20` 且满足 guardrail 的参数组合。
- 当前推荐仍保持现有 improved 配置（`IDSW=20` 版本）。

### 7.2 下一步建议（如继续优化）

若要进一步压低 `IDSW`，建议进入第二轮：

- 放开 ByteTrack 核心关联参数（如 `track_thresh` / `match_thresh` / `track_buffer`）联合搜索；
- 或做“IDSW 事件片段定向优化”（优先优化发生切换的关键时段），而非纯全局平均优化。
